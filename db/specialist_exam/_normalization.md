# 正規化

## 正規化の目的
- データの冗長性を排除して、独立性を高めるために行う。
- 正規化が不十分だと、テーブルへの新しい行を挿入する時や、不要になった行を削除するとき、更新するときに、様々な異状が発生する。(=更新時異状)
- 具体的には、「1 fact 1 place」にすることで更新時異状が発生しないようにする。

### 更新時異状の例
- 第２正規化されていない場合
  - 主キー：店舗ID, 商品ID
  - 関数従属性：店舗ID → 店舗名、商品ID → 商品名、{店舗ID,商品ID} → 在庫数

|店舗ID|店舗名|商品ID|商品名|在庫数|
|-|-|-|-|-|
|01|東京店|001|パソコンA|10|
|01|東京店|002|パソコンB|5|
|02|大阪店|001|パソコンA|8|
|03|名古屋店|003|パソコンC|2|

- 冗長性
  - このテーブルでは、「店舗ID: 001, 店舗: 東京店」と「商品ID: 001, 商品名: パソコンA」が複数箇所に存在している
- 挿入時の更新時異状
  - 在庫として保持する店舗が未決定の状態で、新規商品「商品ID: 004, 商品名：デジカメD」を在庫テーブルに挿入したい時、{店舗ID, 店舗名, 在庫数を}NULLにした状態で挿入することになるが、店舗IDは主キーの一部なので主キー制約に反する。つまり挿入できない。
- 修正時の更新時異状
  - 「商品ID: 001, 商品名: パソコンA」ではなく「商品ID: 001, 商品名: パソコンE」が正しい場合、修正が必要だが、同じ情報が存在する複数の行で同時に更新しないと整合性が失われる。
- 削除事の更新時異状
  - 名古屋店が閉店となったときに、該当する行を削除すると「商品ID: 003, 商品名: パソコンC」という情報が失われる。これを失わないように{店舗ID, 店舗名, 在庫数を}NULLにしようとすると主キー制約に反する。

- 第3正規化されていない場合
  - 主キー：ID
  - 関数従属性：役割ID→役職名称、社員ID→社員氏名、社員ID→役職ID

|社員ID|社員氏名|役職ID|役職名称|
|-|-|-|-|
|001|鈴木|905|社長室長|
|002|佐藤|106|課長|
|003|高橋|106|課長|

- 冗長性
  - 「役職ID：106, 役職名: "課長"」が複数箇所に存在しているため、役職情報{役職ID, 役職名称}に冗長性があると言える。
- 挿入時の更新時状態異状
  - 新しい役職「役職ID: 108, 役職名: "営業本部長"」の設置を計画していて、辞令を交付する社員は決まっていない時、{社員ID, 社員氏名}をNULLにして{役職ID, 役職名称}の関係を挿入しようとすると、主キー制約に反するため挿入できない。
- 